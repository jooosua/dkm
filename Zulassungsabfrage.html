<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pangaea Life – Zulassung erfassen</title>
  <style>
    :root {
      --pl-blue: #004a99;
      --pl-acc: #1b5ef5;
      --pl-bg: #f3f5f7;
      --pl-text: #2b2b2b;
      --pl-card: #ffffff;
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family:"Segoe UI", Roboto, Arial; background: var(--pl-bg); color: var(--pl-text); }
    .container { max-width:560px; margin:5vh auto; background: var(--pl-card); border-radius: var(--radius); overflow:hidden; box-shadow:0 14px 36px rgba(0,0,0,.12); }
    .header { background: linear-gradient(135deg, var(--pl-blue) 0%, #0b57c2 100%); padding:28px 24px 20px; text-align:center; }
    .logo { max-width:190px; height:auto; display:block; margin:0 auto; filter: drop-shadow(0 2px 8px rgba(0,0,0,.2)); }
    .content { padding:32px 28px 28px; }
    h1 { margin:0 0 16px 0; font-size:1.5rem; color: var(--pl-blue); text-align:center; }
    label { display:block; margin:14px 0 6px; font-weight:600; }
    select, input[type="text"] { width:100%; padding:14px 16px; font-size:16px; border:1px solid #d9dde3; border-radius:12px; margin-bottom:16px; }
    button { width:100%; padding:16px; font-size:17px; font-weight:700; border:0; border-radius:14px; background: linear-gradient(90deg,var(--pl-acc),var(--pl-blue)); color:#fff; cursor:pointer; }
    .success { display:none; text-align:center; margin-top:16px; font-weight:700; color:#15803d; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img class="logo" src="https://www.pangaea-life.de/.resources/bayerische-lm/webresources/pangaea-life/img/pangaea-life-logo-white.svg" alt="Pangaea Life">
    </div>
    <div class="content">
      <h1>Zulassung erfassen</h1>
      <p>Bitte teilen Sie uns mit, ob Sie eine Vermittlerzulassung besitzen:</p>
      <form id="zulassungForm">
        <label for="hasLicense">Zulassung vorhanden?</label>
        <select id="hasLicense" required>
          <option value="" disabled selected>Bitte auswählen</option>
          <option value="Ja">Ja</option>
          <option value="Nein">Nein</option>
        </select>

        <div id="licenseDetailsDiv" style="display:none;">
          <label for="licenseDetails">Zulassungsdetails</label>
          <input type="text" id="licenseDetails" placeholder="Bitte Zulassung eintragen">
        </div>

        <button type="submit">Speichern</button>
        <div class="success" id="successMsg">✅ Ihre Angaben wurden erfolgreich gespeichert!</div>
      </form>
    </div>
  </div>

  <script>
    // Anzeige des Textfeldes nur wenn "Ja" ausgewählt
    const hasLicense = document.getElementById('hasLicense');
    const licenseDiv = document.getElementById('licenseDetailsDiv');
    hasLicense.addEventListener('change', () => {
      licenseDiv.style.display = hasLicense.value === 'Ja' ? 'block' : 'none';
    });

    // REST-Call zu Salesforce
    const form = document.getElementById('zulassungForm');
    const successMsg = document.getElementById('successMsg');
    const urlParams = new URLSearchParams(window.location.search);
    const leadId = urlParams.get('leadId');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        Id: leadId,
        Zulassung_vorhanden__c: hasLicense.value,
        Zulassungsdetails__c: document.getElementById('licenseDetails').value
      };

      try {
        const response = await fetch('https://YOUR_SALESFORCE_INSTANCE/services/apexrest/updateLead/' + leadId, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          successMsg.style.display = 'block';
          form.reset();
          licenseDiv.style.display = 'none';
        } else {
          alert('Fehler beim Speichern, bitte versuchen Sie es später.');
        }
      } catch(err) {
        console.error(err);
        alert('Fehler beim Speichern, bitte versuchen Sie es später.');
      }
    });
  </script>
</body>
</html>
